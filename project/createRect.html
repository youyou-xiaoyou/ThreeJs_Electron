<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
</head>

<body>
    <script src="../three.js-r154/build/three.js"></script>

    <script type="importmap">
            {
                "imports": {
                    "three": "../three.js-r154/build/three.module.js",
              "three/addons/": "../three.js-r154/examples/jsm/"
                }
            }
        </script>

    <script type='module' src="rect_prt.js"></script>
    <script type="module" src="AStar.js"></script>
    <script type="module">
        //构建场景
        import { createScene } from "./rect_prt.js";
        createScene();

        //调用createRect添加长方体构件
        import { createRect } from "./rect_prt.js";
        var position1 = [
            0, 0, 0,
            50, 0, 0,
            50, 50, 0,
            0, 50, 0,
            0, 0, 2200,
            50, 0, 2200,
            50, 50, 2200,
            0, 50, 2200,
        ];

        var position2 = [
            550, 0, 0,
            600, 0, 0,
            600, 50, 0,
            550, 50, 0,
            550, 0, 2200,
            600, 0, 2200,
            600, 50, 2200,
            550, 50, 2200,
        ];

        var position3 = [
            550, 750, 0,
            600, 750, 0,
            600, 800, 0,
            550, 800, 0,
            550, 750, 2200,
            600, 750, 2200,
            600, 800, 2200,
            550, 800, 2200,
        ];

        var position4 = [
            0, 750, 0,
            50, 750, 0,
            50, 800, 0,
            0, 800, 0,
            0, 750, 2200,
            50, 750, 2200,
            50, 800, 2200,
            0, 800, 2200,
        ];

        var position5 = [
            50, 0, 0,
            550, 0, 0,
            550, 50, 0,
            50, 50, 0,
            50, 0, 50,
            550, 0, 50,
            550, 50, 50,
            50, 50, 50,
        ];

        var position6 = [
            550, 50, 0,
            600, 50, 0,
            600, 750, 0,
            550, 750, 0,
            550, 50, 50,
            600, 50, 50,
            600, 750, 50,
            550, 750, 50,
        ];

        var position7 = [
            50, 750, 0,
            550, 750, 0,
            550, 800, 0,
            50, 800, 0,
            50, 750, 50,
            550, 750, 50,
            550, 800, 50,
            50, 800, 50,
        ];

        var position8 = [
            0, 50, 0,
            50, 50, 0,
            50, 750, 0,
            0, 750, 0,
            0, 50, 50,
            50, 50, 50,
            50, 750, 50,
            0, 750, 50,
        ];

        var position9 = [
            50, 0, 2150,
            550, 0, 2150,
            550, 50, 2150,
            50, 50, 2150,
            50, 0, 2200,
            550, 0, 2200,
            550, 50, 2200,
            50, 50, 2200,
        ];

        var position10 = [
            550, 50, 2150,
            600, 50, 2150,
            600, 750, 2150,
            550, 750, 2150,
            550, 50, 2200,
            600, 50, 2200,
            600, 750, 2200,
            550, 750, 2200,
        ];

        var position11 = [
            50, 750, 2150,
            550, 750, 2150,
            550, 800, 2150,
            50, 800, 2150,
            50, 750, 2200,
            550, 750, 2200,
            550, 800, 2200,
            50, 800, 2200,
        ];

        var position12 = [
            0, 50, 2150,
            50, 50, 2150,
            50, 750, 2150,
            0, 750, 2150,
            0, 50, 2200,
            50, 50, 2200,
            50, 750, 2200,
            0, 750, 2200,
        ];

        var position13 = [
            200, 0, 50,
            250, 0, 50,
            250, 50, 50,
            200, 50, 50,
            200, 0, 2150,
            250, 0, 2150,
            250, 50, 2150,
            200, 50, 2150,
        ];

        var position14 = [
            200, 750, 50,
            250, 750, 50,
            250, 800, 50,
            200, 800, 50,
            200, 750, 2150,
            250, 750, 2150,
            250, 800, 2150,
            200, 800, 2150,
        ];

        var position15 = [
            200, 50, 800,
            250, 50, 800,
            250, 750, 800,
            200, 750, 800,
            200, 50, 850,
            250, 50, 850,
            250, 750, 850,
            200, 750, 850,
        ];

        var position16 = [
            200, 50, 1600,
            250, 50, 1600,
            250, 750, 1600,
            200, 750, 1600,
            200, 50, 1650,
            250, 50, 1650,
            250, 750, 1650,
            200, 750, 1650,
        ];
        createRect(position1)
        createRect(position2)
        createRect(position3)
        createRect(position4)
        createRect(position5)
        createRect(position6)
        createRect(position7)
        createRect(position8)
        createRect(position9)
        createRect(position10)
        createRect(position11)
        createRect(position12)
        createRect(position13)
        createRect(position14)
        createRect(position15)
        createRect(position16)

        //根据起点，终点，途径点生成路径
        import { aStarFindPath } from "./AStar.js";
        //将三维路径投射到二维，这里选择x = 250的平面，不同情况下选择的投影面不同
        let x = 250;

        //path[]接收Astar算法返回的路径转折点
        let path = new Array();
        /* 
            aStarFindPath(world_x, world_y, safeAngle, startPoint, endPoint, passByPoints)
            world_x,world_y:将整个柜体投影到x = 250得到的边界尺寸
            safeAngle:自定义安全的弯折度数
            startPoint, endPoint, passByPoints:起点，终点，途径点
        */
        path = aStarFindPath(800, 2200, 90, [400, 825], [400, 1625], []);

        //按照一定算法将二维坐标换算成三维坐标
        let y1 = path[0][0], z1 = path[0][1], y2 = path[1][0], z2 = path[1][1];

        let path1 = [
            x, y1 - 50, z1,
            x + 20, y1 - 50, z1,
            x + 20, y1 + 50, z1,
            x, y1 + 50, z1,
            x, y2 - 50, z2,
            x + 20, y2 - 50, z2,
            x + 20, y2 + 50, z2,
            x, y2 + 50, z2,
        ]

        createRect(path1, 0x00FF00);

    </script>
</body>

</html>